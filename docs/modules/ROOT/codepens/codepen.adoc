++++
{% comment %} Add cloud script(s) {% endcomment %}
{%- if codepen.script.include -%}
<script src="{{ codepen.script.url }}" referrerpolicy="origin"></script>
{%- if codepen.type == 'tinydrive' -%}
<style>
{% include 'tinydrive.css' %}
</style>
{%- endif -%}
{%- endif -%}

{% comment %} Creates the codepen tabs {% endcomment %}
<div id="codepen_{{ codepen.id }}" class="codepen" {% if codepen.height %}style="min-height:{{ codepen.height }}px;"{% endif %}>
    <div class="codepen_tabs">
        {% for tab in codepen.tabs %}
        <a href="#" id="codepen_tab_{{ tab.name }}_{{ codepen.id }}" class="{{ tab.class }}">{{ tab.text }}</a>
        {% endfor %}
    </div>

    {% comment %} Adds style.css to page if provided {% endcomment %}
    <div id="codepen_pane_run_{{ codepen.id }}" {% if "run" != codepen.initialTab %}style="display:none;"{% endif %}>
        {% if codepen.content.hasCss %}
            <style type="text/css">
                {{ codepen.content.css }}
            </style>
        {% endif %}
        {{ codepen.content.html }}
    </div>

    {% comment %} Adds HTML tab content {% endcomment %}
    <div id="codepen_pane_html_{{ codepen.id }}" {% if "html" != codepen.initialTab %}style="display:none;"{% endif %}>
++++
[source,html]
----
{{ codepen.content.html }}
----
++++
    </div>

    {% comment %} If style.css exists, add CSS tab content {% endcomment %}
    {% if codepen.content.hasCss %}
    <div id="codepen_pane_css_{{ codepen.id }}" {% if "css" != codepen.initialTab %}style="display:none;"{% endif %}>
++++
[source,css]
----
{{ codepen.content.css }}
----
++++
    </div>
    {% endif %}

    {% comment %} Add content to JS tab from index.js or example.js {% endcomment %}
    <div id="codepen_pane_js_{{ codepen.id }}" {% if "js" != codepen.initialTab %}style="display:none;"{% endif %}>
++++
[source,js]
----
{{ codepen.content.examplejs }}
----
++++
    </div>
</div>

{% comment %} Changes initial tab where tab is specified {% endcomment %}
<form action="https://codepen.io/pen/define" method="POST" target="_blank" id="codepen_form_{{ codepen.id }}">
<input type="hidden" name="data" id="codepen_data_{{ codepen.id }}" />
</form>

<script>
(function() {
  // Add the ie11_optional class if running IE
  var isIE = !!window.MSInputMethodContext && !!document.documentMode;
  if (isIE && document.getElementsByClassName("ie11_optional")[0] !== undefined) {
    document.getElementsByClassName("ie11_optional")[0].style.display = 'none';
  }
})();

{% comment %} Add index.js to the page (primary tab content) {% endcomment %}
(function() {
{{ codepen.content.js }}
})();

(function() {
  var id = "{{ codepen.id }}";

  {% comment %} Add index.js and HTML to variables {% endcomment %}
  var html = decodeURIComponent("{{ codepen.content.html | uri_escape }}");
  var js = decodeURIComponent("{{ codepen.content.js | uri_escape }}");

  {% comment %} If style.css provided, add to variable {% endcomment %}
  {% comment %} set which tabz are shown in on codepen site {% endcomment %}
  {% if codepen.content.hasCss %}
  var css = decodeURIComponent("{{ codepen_css | uri_escape }}");
  var tabNames = ["run","html","css","js"];
  {% else %}
  var css = "";
  var tabNames = ["run","html","js"];
  {% endif %}

  {% comment %} Data to send to codepen dot io via form input {% endcomment %}
  /* Note: there are some other fields we could populate here to polish this. */
  /* See: https://blog.codepen.io/documentation/api/prefill/ */
  var data = {
    title: "{{ codepen.runText }} Example",
    description: '',
    html: html,
    css: css,
    css_external: 'https://www.tiny.cloud/css/codepen.min.css',
    js: js,
    js_external: '{{ codepen.script.url }}'
  };
  document.getElementById("codepen_data_{{ codepen.id }}").value = JSON.stringify(data);

  {% comment %} Below is just tab selection/change logic {% endcomment %}
  var tabs = tabNames.map(function(t) {
    return {
      tab: document.getElementById("codepen_tab_" + t + "_" + id),
      pane: document.getElementById("codepen_pane_" + t + "_" + id)
    };
  });

  tabs.forEach(function(t) {
    t.tab.onclick = function(e) {
      tabs.forEach(function(tt) {
        tt.pane.style.display = t === tt ? 'block' : 'none';
        tt.tab.className = t === tt ? 'codepen_tab_selected' : 'codepen_tab_deselected';
      });
      e.preventDefault();
    };
  });

  if (document.getElementById("codepen_tab_codepen_" + id) !== null) {
    document.getElementById("codepen_tab_codepen_" + id).onclick = function() {
      document.getElementById("codepen_form_" + id).submit();
    };
  }
})();
</script>
++++